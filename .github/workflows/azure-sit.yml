name: SIT Pipeline

on:    
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:


# 
jobs:
  deploy_sit:
    name: Deploy to SIT
    runs-on: ubuntu-latest
    environment:
      name: SIT
      url: 'http://xxxx/hello'
    steps:
    - name: Set env
      run: echo "GITHUB_SHA_SHORT=$(echo $GITHUB_SHA | cut -c 1-6)" >> $GITHUB_ENV
    - name: Test
      run: echo $GITHUB_SHA_SHORT

    - name: debug var
      run: |
        MY_VAR=$(git describe --tags --abbrev=0)
        echo "::add-mask::$MY_VAR"


    - uses: actions/github-script@v4
      name: make tag name
      env:
          ENV_VAR: $MY_VAR
      with:
        script: |
          const { ENV_VAR } = process.env
          console.log(`hello ${ENV_VAR}`)


    - name: create tag
      run: |
        git tag 0.1.4
        git push origin --tags 0.1.4

    - name: echo ref
      run: echo ${{ github.ref }}



